<!DOCTYPE html>
<html lang="es">
<head>
  <style>
    /* Grilla flexible para multimedia */
    .grid-media { 
        display: flex; 
        gap: 15px; 
        flex-wrap: wrap; 
        margin-top: 15px; 
    }
    
    /* ESTILO RECTANGULAR PARA IM√ÅGENES */
    .media-item {
        display: block;
        width: 150px;
        height: 120px;
        position: relative; 
        border-radius: 8px;
        overflow: hidden; 
        border: 1px solid #ddd;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        transition: transform 0.2s, box-shadow 0.2s; 
        background: #f8f9fa;
        cursor: pointer;
    }

    .media-item:hover { 
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        border-color: #003a70;
    }
    
    .media-item img { 
        width: 100%; 
        height: 100%; 
        object-fit: cover;
    }
    
    /* ESTILO PARA VIDEOS */
    .media-item.is-video {
        width: 220px;
        height: 130px;
        background: #000;
        display: flex; 
        align-items: center; 
        justify-content: center;
        border: none;
    }
    .media-item.is-video video { 
        width: 100%; 
        height: 100%; 
        object-fit: cover; 
    }
    
    .seccion-media { margin-top: 30px; }
    .titulo-seccion { 
        font-weight: bold; 
        color: #555; 
        font-size: 1rem; 
        margin-bottom: 10px; 
        border-bottom: 1px solid #eee; 
        padding-bottom: 5px; 
        display: inline-block;
    }

    /* === NUEVO ESTILO PARA EL CONTENIDO DEL TEXTO === */
    .contenido-noticia-wrapper {
        background-color: #fcfcfc; /* Fondo muy suave para diferenciar */
        border: 1px solid #eee;    /* Borde sutil englobando todo */
        border-radius: 8px;        /* Bordes redondeados */
        padding: 25px;             /* Espacio interno (Padding) */
        margin-top: 20px;          /* Separaci√≥n del t√≠tulo */
        
        /* M√°gica para evitar desbordamiento */
        word-wrap: break-word;     
        overflow-wrap: break-word; 
        max-width: 100%;           
    }
  </style>
</head>
<body>

<div class="contenedor">
  <a href="/noticias" class="link-volver">‚Üê Volver a Noticias</a>

  <div class="panel" style="margin-top: 20px; padding: 0; overflow: hidden;">
    
    <% if (noticia.imagen) { %>
      <a href="<%= noticia.imagen %>" target="_blank" style="display: block; width: 100%; height: 350px; overflow: hidden;">
        <img src="<%= noticia.imagen %>" style="width: 100%; height: 100%; object-fit: cover;" title="Ver portada completa">
      </a>
    <% } %>
    
    <div style="padding: 30px;">
      <h1 style="color: #003a70; margin-bottom: 5px; font-size: 2rem;"><%= noticia.titulo %></h1>
      
      <% if (noticia.subtitulo) { %>
        <h3 style="color: #666; margin-top: 0; font-weight: normal; font-size: 1.2rem;"><%= noticia.subtitulo %></h3>
      <% } %>
      
      <p style="font-size: 0.85rem; color: #999; margin-bottom: 10px;">
        Publicado el <%= new Date(noticia.fecha_creacion).toLocaleDateString('es-CL', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %>
      </p>

      <div class="contenido-noticia-wrapper">
        <div style="line-height: 1.8; white-space: pre-wrap; color: #333; font-size: 1.05rem;">
          <%= noticia.contenido %>
        </div>
      </div>

      <% 
         let adjuntos = [];
         try {
           if (noticia.adjuntos) adjuntos = JSON.parse(noticia.adjuntos);
         } catch(e) {}

         const imagenes = adjuntos.filter(a => a.tipo === 'image');
         const videos = adjuntos.filter(a => a.tipo === 'video');
      %>

      <% if (imagenes.length > 0 || videos.length > 0) { %>
        <% if (imagenes.length > 0) { %>
          <div class="seccion-media">
            <div class="titulo-seccion">üì∏ Galer√≠a de Im√°genes</div>
            <div class="grid-media">
              <% imagenes.forEach(img => { %>
                <a href="<%= img.url %>" target="_blank" class="media-item" title="Ver imagen completa">
                  <img src="<%= img.url %>" alt="<%= img.nombre %>">
                </a>
              <% }) %>
            </div>
          </div>
        <% } %>

        <% if (videos.length > 0) { %>
          <div class="seccion-media">
            <div class="titulo-seccion">üé• Videos</div>
            <div class="grid-media">
              <% videos.forEach(vid => { %>
                <div class="media-item is-video">
                  <video src="<%= vid.url %>" controls title="<%= vid.nombre %>"></video>
                </div>
              <% }) %>
            </div>
          </div>
        <% } %>

      <% } %>

      <% if (typeof can !== 'undefined' && can.noticias_write) { %>
        <hr style="margin: 40px 0 20px 0; border: 0; border-top: 1px solid #eee;">
        <form action="/noticias/eliminar/<%= noticia.id %>" method="POST" onsubmit="return confirm('¬øSeguro que deseas eliminar esta noticia?');">
          <button type="submit" style="background: #dc3545; color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer;">
            üóëÔ∏è Eliminar Noticia
          </button>
        </form>
      <% } %>

    </div>
  </div>
</div>

</body>
</html>