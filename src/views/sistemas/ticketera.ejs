<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title><%= titulo %></title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    header { background: #003366; color: #fff; padding: 10px 20px; }
    header h1 { margin: 0; }
    nav { margin-top: 8px; }
    nav a { color: #fff; margin-right: 15px; text-decoration: none; }
    main { padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 15px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #f0f0f0; }
    .estado-Abierto { color: red; font-weight: bold; }
    .estado-En\ progreso { color: orange; font-weight: bold; }
    .estado-Cerrado { color: green; font-weight: bold; }
    .boton { display: inline-block; padding: 8px 12px; background: #003366; color: #fff; text-decoration: none; border-radius: 4px; }
  </style>
</head>

  <main>
    <h2>Ticketera</h2>

    <p>
      <a class="boton" href="/sistemas/ticketera/nuevo">Crear nuevo ticket</a>
    </p>

    <% if (!tickets || tickets.length === 0) { %>
      <p>No hay tickets registrados.</p>
    <% } else { %>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Título</th>
            <th>Categoría</th>
            <th>Prioridad</th>
            <th>Estado</th>
            <th>Creado</th>
          </tr>
        </thead>
        <tbody>
          <% tickets.forEach(t => { %>
            <tr>
              <td><a href="/sistemas/ticketera/<%= t.id %>"><%= t.id %></a></td>
              <td><%= t.titulo %></td>
              <td><%= t.categoria || '-' %></td>
              <td><%= t.prioridad %></td>
              <td class="estado-<%= t.estado.replace(' ', '\\ ') %>"><%= t.estado %></td>
              <td><%= t.fecha_creacion.toLocaleString('es-CL', { timeZone: 'America/Santiago' }).slice(0, 19).replace('T',' ') %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    <% } %>
  </main>
</body>
</html>
