<%
  // Función para invertir "APELLIDO NOMBRE" a "Nombre Apellido"
  function titleCase(s) {
    if (!s) return '';
    // Limpiamos y separamos por espacios
    const palabras = String(s).toLowerCase().trim().split(/\s+/);
    
    if (palabras.length >= 2) {
      // Tomamos el primero como apellido y el resto como nombre(s)
      const apellido = palabras[0];
      const nombres = palabras.slice(1);
      
      // Formateamos: Nombre(s) Apellido
      const nombreFormateado = nombres.map(n => n.charAt(0).toUpperCase() + n.slice(1)).join(' ');
      const apellidoFormateado = apellido.charAt(0).toUpperCase() + apellido.slice(1);
      
      return `${nombreFormateado} ${apellidoFormateado}`;
    }
    
    // Si solo hay una palabra, solo capitalizamos
    return palabras.map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
  }

  const mesNum = new Date().getMonth() + 1; 
%>

<h2>Bienvenida/o a la intranet</h2>

<div class="home-layout">

  <div class="home-left">
    <a href="/sistemas/tickets" class="home-ti-link" title="Ir a Tickets">
      <div class="home-ti-card">
        <img
          src="/img/Img%20Servicios%20TI.png"
          alt="Servicios TI"
          class="home-ti-img"
        />
      </div>
    </a>
  </div>

  <div class="home-right">

    <div class="tarjeta">
      <h3>USD del día</h3>
      <p class="home-usd"><strong><%= usdHoy %></strong></p>
    </div>

    <div class="tarjeta">
      <h3>Cumpleaños de <%= mesNombre %></h3>

      <% if (!cumpleaniosMes || cumpleaniosMes.length === 0) { %>
        <p>No hay cumpleaños registrados para este mes.</p>
      <% } else { %>

        <div class="cumple-cards">
          <% cumpleaniosMes.forEach((p) => { %>
            <div class="cumple-card <%= (p.dia === diaHoy) ? 'cumple-hoy' : '' %>">
              <div class="cumple-fecha">
                <span class="cumple-dia"><%= p.dia %>/<%= mesNum %></span>
              </div>

              <div class="cumple-info">
                <div class="cumple-nombre"><%= titleCase(p.nombre) %></div>
                <div class="cumple-area">Área: <%= titleCase(p.area) %></div>
              </div>
            </div>
          <% }) %>
        </div>

      <% } %>
    </div>

  </div>
</div>