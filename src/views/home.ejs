<%
  // Función para convertir "APELLIDO1 APELLIDO2 NOMBRE" a "Nombre Apellido1 Apellido2"
  function titleCase(s) {
    if (!s) return '';
    const palabras = String(s).toLowerCase().trim().split(/\s+/);
    
    // Si tiene 3 o más palabras (Apellido1 Apellido2 Nombre)
    if (palabras.length >= 3) {
      const apellido1 = palabras[0];
      const apellido2 = palabras[1];
      const nombres = palabras.slice(2); 
      
      const nombreFormateado = nombres.map(n => n.charAt(0).toUpperCase() + n.slice(1)).join(' ');
      const ap1Formateado = apellido1.charAt(0).toUpperCase() + apellido1.slice(1);
      const ap2Formateado = apellido2.charAt(0).toUpperCase() + apellido2.slice(1);
      
      return `${nombreFormateado} ${ap1Formateado} ${ap2Formateado}`;
    } 
    // Si tiene 2 palabras (Apellido1 Nombre)
    else if (palabras.length === 2) {
      const apellido = palabras[0];
      const nombre = palabras[1];
      return `${nombre.charAt(0).toUpperCase() + nombre.slice(1)} ${apellido.charAt(0).toUpperCase() + apellido.slice(1)}`;
    }
    
    return palabras.map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
  }

  const mesNum = new Date().getMonth() + 1;
%>

<h2>Bienvenida/o a la intranet</h2>

<div class="home-layout">
  <div class="home-left">
    <a href="/sistemas/tickets" class="home-ti-link" title="Ir a Tickets">
      <div class="home-ti-card">
        <img src="/img/Img%20Servicios%20TI.png" alt="Servicios TI" class="home-ti-img" />
      </div>
    </a>
  </div>

  <div class="home-right">
    <div class="tarjeta">
      <h3>USD del día</h3>
      <p class="home-usd"><strong><%= usdHoy %></strong></p>
    </div>

    <div class="tarjeta">
      <h3>Cumpleaños de <%= mesNombre %></h3>

      <% if (!cumpleaniosMes || cumpleaniosMes.length === 0) { %>
        <p>No hay cumpleaños registrados para este mes.</p>
      <% } else { %>
        <div class="cumple-cards">
  <% cumpleaniosMes.forEach((p) => { 
    // Determinamos la clase según la fecha
    let estadoClase = '';
    if (p.dia < diaHoy) {
      estadoClase = 'cumple-pasado'; // Verde
    } else if (p.dia === diaHoy) {
      estadoClase = 'cumple-hoy';    // Resaltado especial
    } else {
      estadoClase = 'cumple-futuro'; // Azul (actual)
    }
  %>
          <div class="cumple-card <%= estadoClase %>">
            <div class="cumple-fecha">
              <span class="cumple-dia"><%= p.dia %>/<%= mesNum %></span>
              </div>
                <div class="cumple-info">
                  <div class="cumple-nombre"><%= titleCase(p.nombre) %></div>
                  <div class="cumple-area">Área: <%= titleCase(p.area) %></div>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>
    </div>
  </div>
</div>