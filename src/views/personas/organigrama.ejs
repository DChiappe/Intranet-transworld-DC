<h2>Organigrama</h2>
<p>A continuación se presenta el organigrama actualizado de Transworld.</p>

<% const canWrite = (typeof can !== 'undefined' && can.organigrama_write); [cite: 28] %>
<% const url = (typeof organigramaUrl !== 'undefined' && organigramaUrl) ? organigramaUrl : "/img/Organigrama%20TW.png"; [cite: 29] %>

<div class="panel" style="margin-bottom: 16px;">
  <h3 class="panel-title">Archivo actual</h3>

  <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
    <a class="btn btn-primario" href="<%= url %>" target="_blank" rel="noopener">Descargar / Ver Original</a>

    <% if (canWrite) { %>
      <form action="/personas/organigrama/eliminar" method="POST"
          
      onsubmit="return confirm('¿Eliminar el organigrama actual?');" style="margin:0;"> [cite: 30]
        <button type="submit" class="btn btn-peligro">Eliminar</button>
      </form>
    <% } %>
  </div>

  <% if (!canWrite) { %>
    <p class="small-text" style="margin-top:10px;">
    
      Tienes acceso de solo lectura en esta sección. [cite: 31]
    </p>
  <% } %>
</div>

<% if (canWrite) { %>
  <div class="panel" style="margin-bottom: 16px;">
    <h3 class="panel-title">Subir / Reemplazar organigrama</h3>

    <form action="/personas/organigrama/subir" method="POST" enctype="multipart/form-data">
      <input type="file" name="organigrama" accept="image/*,application/pdf" required>
      <button type="submit" class="btn btn-primario">Subir</button>
    </form>
    <p class="small-text" style="margin-top:8px;">
      Puedes subir imagen (PNG/JPG) o PDF.
      El nuevo archivo reemplazará al anterior. [cite: 32]
    </p>
  </div>
<% } %>

<div class="organigrama-contenedor" style="margin-top: 20px;">
  <p style="margin-bottom: 10px; font-style: italic; color: #555;">Haz clic en la imagen para ampliar.</p>
  
  <img
    src="<%= url %>"
    alt="Organigrama Transworld"
    class="galeria-thumb"
    data-full="<%= url %>"
    style="max-width: 300px; width: 100%; cursor: pointer; border: 1px solid #ddd; padding: 5px; background: white; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);"
  >
</div>

<div id="modalImagen" class="modal-imagen">
  <div class="modal-imagen-contenido">
    <span class="modal-cerrar">&times;</span>
    <img id="modalImagenGrande" src="" alt="Vista previa" style="background-color: white;">
  </div>
</div>

<script>
  (function () {
    const modal = document.getElementById('modalImagen');
    const modalImg = document.getElementById('modalImagenGrande');
    const cerrar = document.querySelector('.modal-cerrar');
    // Seleccionamos la imagen por la clase que le asignamos arriba
    const thumb = document.querySelector('.galeria-thumb');

    if (thumb) {
      thumb.addEventListener('click', function () {
        modalImg.src = this.getAttribute('data-full');
        modal.style.display = 'flex';
      });
    }

    if (cerrar) {
      cerrar.addEventListener('click', () => modal.style.display = 'none');
    }

    window.addEventListener('click', (e) => { 
      if (e.target === modal) modal.style.display = 'none'; 
    });
  })();
</script>